LABEL ROTATE_VECTOR


$VECTOR_X = 40
$VECTOR_Y = 41
$VECTOR_Z = 42

$VECTOR_NEXT_X = 43
$VECTOR_NEXT_Y = 44
$VECTOR_NEXT_Z = 45

$GYRO_X = 32
$GYRO_Y = 33
$GYRO_Z = 34

// --------------------

// -- OUT_X = VEC_X - VEC_Y X GYRO_Z + VEC_Z X GYRO_Y
// -- OUT_Y = VEC_Y - VEC_Z X GYRO_X + VEC_X X GYRO_Z
// -- OUT_Z = VEC_Z - VEC_X X GYRO_Y + VEC_Y X GYRO_X

// ~~~ X ~~~ -- OUT_X = VEC_X - VEC_Y X GYRO_Z + VEC_Z X GYRO_Y
LDADDR $GYRO_Z
MOV RAM A
NEG_A
LDADDR $VECTOR_Y
MOV RAM X
LDADDR $VECTOR_X
MOV RAM B
MULADD
MOV RES B

LDADDR $GYRO_Y
MOV RAM A
LDADDR $VECTOR_Z
MOV RAM X
MULADD
LDADDR $VECTOR_NEXT_X
MOV RES RAM


// ~~~ Y ~~~ -- OUT_Y = VEC_Y - VEC_Z X GYRO_X + VEC_X X GYRO_Z
LDADDR $GYRO_X
MOV RAM A
NEG_A
LDADDR $VECTOR_Z
MOV RAM X
LDADDR $VECTOR_Y
MOV RAM B
MULADD
MOV RES B

LDADDR $GYRO_Z
MOV RAM A
LDADDR $VECTOR_X
MOV RAM X
MULADD
LDADDR $VECTOR_NEXT_Y
MOV RES RAM


// ~~~ Z ~~~ -- OUT_Z = VEC_Z - VEC_X X GYRO_Y + VEC_Y X GYRO_X
LDADDR $GYRO_Y
MOV RAM A
NEG_A
LDADDR $VECTOR_X
MOV RAM X
LDADDR $VECTOR_Z
MOV RAM B
MULADD
MOV RES B

LDADDR $GYRO_X
MOV RAM A
LDADDR $VECTOR_Y
MOV RAM X
MULADD
LDADDR $VECTOR_NEXT_Z
MOV RES RAM

HALT